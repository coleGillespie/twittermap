// Test Observer
// -------------------------------------------------- //

App.on("get:index", function(req, res) {
    Todo.view('unfinished', function (err, tasks) {
        res.render("index", { tasks : tasks});
    });
});

App.on("get:done", function(req, res) {

    Todo.view('finished', function (err, tasks) {
        res.render("index", { tasks : tasks});
    });

});

App.on("db:change-todo", function(change, doc) {
    doc.done && App.send("update-list", doc);
});

App.on("websocket:newTodo", function(data) {
    console.log("todo");
});

App.Wiretap(function(socket) {

    socket.newTodo = function(data) {
        Todo.save({ task: data.task, done: false }, function(err, doc) {  
            Todo.send(doc.id, "newTodo");
        });
    };

    socket.complete = function(data) {
        Todo.update(data._id, { done: true });
    };
    
});


App.Wiretap("/done", function(socket) {

    socket.newTodo = function(data) {
        Todo.save({ task: data.task, done: false }, function(err, doc) {  
            Todo.send(doc.id, "newTodo");
        });
    };

    socket.complete = function(data) {
        Todo.update(data._id, { done: true });
    };
    
});