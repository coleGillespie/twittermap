
// A nifty helper to load all files within a directory
// 
// Note : This is basically a glorified "require all in directory" function.
//        Should further releases of node include such functionality, it will
//        be deprecated.

module.exports.load = function(module) {
    
    var fs = require('fs');
    
    // Validates if a file is not hidden and ends in .js or .coffee
    var fileEX = /^[^.].+\.(js|coffee)/
    ,   d      = process.cwd() + "/" + module;

    // Try to read the directory
    try { fs.statSync(d); }
    // No? Return an error;
    catch (e) { return this; }

    (function traverse(dir, stack) {

        stack.push(dir);
        
        fs.readdirSync(stack.join('/')).forEach(function (file) {
            
            if (file[0] == '.' || file === 'vendor') return;
            
            var path = stack.concat([file]).join('/'),
            stat = fs.statSync(path);
            
            if ( stat.isFile() && fileEX.test(path)) {
                require(path);
            } else if (stat.isDirectory()) {
                traverse(file, stack);
            }

        });
        
        stack.pop();
        
    })(d, []);
    
    return this;
};
